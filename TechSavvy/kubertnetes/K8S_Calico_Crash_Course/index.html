<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubertnetes Calico Crash Course | WISeAgent Blogs</title>
    <link rel="stylesheet" href="/blogs/assets/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="/blogs/">WISeAgent Blogs</a></h1>
            
                <nav>
                    <a href="/blogs/KnowledgeBase/kubertnetes/">kubertnetes</a>
                </nav>
            
        </div>
    </header>

    <div class="container">
        <main>
            <article class="post-content">
    <header class="post-header">
        <h1>Kubertnetes Calico Crash Course</h1>
        <time datetime="2025-03-23T00:00:00.000Z">March 23, 2025</time>
    </header>

    <h1>Kubertnetes Calico Crash Course</h1>
<h2>Table of Contents</h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#core-components">Core Components</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#networking-mechanics">Networking Mechanics</a></li>
<li><a href="#pod-to-pod-communication">Pod-to-Pod Communication</a></li>
<li><a href="#network-policies">Network Policies</a></li>
<li><a href="#advanced-features">Advanced Features</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#configuration-discovery">Configuration Discovery</a></li>
</ol>
<hr>
<h2>Introduction</h2>
<p>Calico is a cloud-native networking solution providing:</p>
<ul>
<li>High-performance container networking</li>
<li>Advanced network security policies</li>
<li>Cross-platform compatibility (K8s, OpenStack, bare metal)</li>
<li>Choice of data planes (Linux, eBPF, Windows)</li>
</ul>
<hr>
<h2>Core Components</h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Function</th>
<th>Runs On</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Felix</strong></td>
<td>Programs routes/ACLs</td>
<td>Each node</td>
</tr>
<tr>
<td><strong>BIRD</strong></td>
<td>BGP route distribution</td>
<td>Each node</td>
</tr>
<tr>
<td><strong>confd</strong></td>
<td>Config generation</td>
<td>Control nodes</td>
</tr>
<tr>
<td><strong>CNI Plugin</strong></td>
<td>Pod networking</td>
<td>Each node</td>
</tr>
<tr>
<td><strong>Typha</strong></td>
<td>API server proxy (large clusters)</td>
<td>Control nodes</td>
</tr>
</tbody>
</table>
<hr>
<h2>Installation</h2>
<pre><code class="language-bash"># Install operator
kubectl create -f https://docs.projectcalico.org/manifests/tigera-operator.yaml

# Apply custom resources
kubectl create -f https://docs.projectcalico.org/manifests/custom-resources.yaml

# Verify installation
watch kubectl get pods -n calico-system
</code></pre>
<hr>
<h2>Networking Mechanics</h2>
<h3>IP Address Management (IPAM)</h3>
<pre><code class="language-yaml">apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: default-pool
spec:
  cidr: 192.168.0.0/16
  ipipMode: CrossSubnet
  natOutgoing: true
</code></pre>
<h3>Routing Options</h3>
<ol>
<li>
<p><strong>BGP Direct Routing</strong></p>
<ul>
<li>Uses node IPs for pod-to-pod communication</li>
<li>Requires BGP-enabled network infrastructure</li>
</ul>
</li>
<li>
<p><strong>Overlay Networks</strong></p>
<ul>
<li>IP-in-IP (protocol 4) or VXLAN (UDP 4789)</li>
<li>Works across any L3 network</li>
</ul>
</li>
</ol>
<h2>Pod-to-Pod Communication</h2>
<h3>Architecture Overview</h3>
<p>Calico enables direct pod-to-pod communication using these key components:</p>
<ul>
<li>veth pairs for same-node communication</li>
<li>tunl0 interface for IP-in-IP encapsulation</li>
<li>BGP routing for cross-node traffic</li>
<li>iptables/eBPF for policy enforcement</li>
</ul>
<pre><code class="language-shell">graph TD
    A[Pod A] --&gt;|veth pair| B[Host A]
    B --&gt;|BGP/Overlay| C[Host B]
    C --&gt;|veth pair| D[Pod B]
</code></pre>
<h3>Communication Flow</h3>
<p><strong>Same node</strong></p>
<pre><code>sequenceDiagram
    Pod1-&gt;&gt;veth1: Outgoing packet
    veth1-&gt;&gt;Linux Bridge: Forward
    Linux Bridge-&gt;&gt;veth2: Direct delivery
    veth2-&gt;&gt;Pod2: Incoming packet

</code></pre>
<p><strong>Cross-node</strong></p>
<pre><code>sequenceDiagram
    Pod1-&gt;&gt;tunl0: Encapsulated packet
    tunl0-&gt;&gt;Node1 NIC: Add outer header (src:10.30.1.1, dst:10.30.1.2)
    Node1 NIC-&gt;&gt;Node2 NIC: Routed via underlay
    Node2 NIC-&gt;&gt;tunl0: Decapsulate
    tunl0-&gt;&gt;Pod2: Deliver original packet
</code></pre>
<h3>Configuration</h3>
<ol>
<li>IP Pool Setup
Define CIDR and encapsulation mode:</li>
</ol>
<pre><code class="language-text">apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: default-pool
spec:
  cidr: 192.168.0.0/16
  ipipMode: Always  # Options: Always, CrossSubnet, Never
  vxlanMode: Never
  natOutgoing: true
</code></pre>
<ol start="2">
<li>Interface Detection
Configure IP autodetection method:</li>
</ol>
<pre><code class="language-text"># calico-config ConfigMap
data:
  ip_autodetection_method: &quot;interface=eth.*&quot;
</code></pre>
<ol start="3">
<li>BGP Configuration
For direct routing without encapsulation:</li>
</ol>
<pre><code class="language-bash">calicoctl create -f - &lt;&lt;EOF
apiVersion: projectcalico.org/v3
kind: BGPConfiguration
metadata:
  name: default
spec:
  logSeverityScreen: Info
  nodeToNodeMeshEnabled: true
EOF
</code></pre>
<h3>Verification</h3>
<ol>
<li>Check routes on worker node:</li>
</ol>
<pre><code class="language-bash">ip route show | grep calico
# Example output:
# 192.168.1.0/24 via 10.30.1.1 dev tunl0 proto bird 
</code></pre>
<ol start="2">
<li>Test pod connectivity:</li>
</ol>
<pre><code class="language-bash">kubectl exec pod1 -- ping -c 3 &lt;pod2-ip&gt;
</code></pre>
<ol start="3">
<li>Inspect BGP peers:</li>
</ol>
<pre><code class="language-bash">calicoctl node status
# Output:
# IPv4 BGP status
# +--------------+-------------------+-------+----------+-------------+
# | PEER ADDRESS |     PEER TYPE     | STATE |  SINCE   |    INFO     |
# +--------------+-------------------+-------+----------+-------------+
# | 10.30.1.2    | node-to-node mesh | up    | 09:32:44 | Established |
# +--------------+-------------------+-------+----------+-------------+
</code></pre>
<h3>Troubleshooting Common Issues</h3>
<ol>
<li>Missing Routes
Ensure Calico pods are running:</li>
</ol>
<pre><code class="language-bash">kubectl get pods -n calico-system
</code></pre>
<ol start="2">
<li>Encapsulation Mismatch
Verify IP pool configuration matches cluster network:</li>
</ol>
<pre><code class="language-bash">calicoctl get ippool -o yaml
</code></pre>
<ol start="3">
<li>Firewall Conflicts
Required open ports:</li>
</ol>
<ul>
<li>IP-in-IP: Protocol 4</li>
<li>VXLAN: UDP 4789</li>
<li>BGP: TCP 179</li>
</ul>
<ol start="4">
<li>Interface Detection
Check detected host IP:</li>
</ol>
<pre><code class="language-bash">calicoctl get node &lt;node-name&gt; -o yaml | grep 'ipv4Address'
</code></pre>
<p>This implementation enables near line-rate performance (&lt;1ms latency) while maintaining Kubernetes network model compliance146. For hybrid cloud deployments, consider VXLAN encapsulation when BGP isn't feasible25.</p>
<h3>Configuration Matrix</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Configuration</th>
<th>Performance</th>
<th>Requirements</th>
</tr>
</thead>
<tbody>
<tr>
<td>Same Node</td>
<td>Direct veth routing</td>
<td>10 Î¼s latency</td>
<td>Default setup</td>
</tr>
<tr>
<td>Cross-Node/BGP</td>
<td>BGP routing table</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code class="language-bash"># Inspect interfaces
ip link show | grep cali

# View BGP peers
birdcl -s /var/run/calico/bird.ctl show protocols
</code></pre>
<hr>
<h2>Network Policies</h2>
<h3>Example: Multi-Tier App Security</h3>
<pre><code class="language-yaml">apiVersion: projectcalico.org/v3
kind: NetworkPolicy
metadata:
  name: frontend-policy
spec:
  selector: role == 'frontend'
  ingress:
    - action: Allow
      protocol: TCP
      source:
        selector: app == 'ingress-controller'
      destination:
        ports:[443]
  egress:
    - action: Allow
      protocol: TCP
      destination:
        selector: role == 'backend'
        ports:[8080]
</code></pre>
<hr>
<h2>Advanced Features</h2>
<ol>
<li>
<p><strong>eBPF Data Plane</strong></p>
<pre><code class="language-bash">calicoctl patch kubecontrollersconfiguration default \
  --patch='{&quot;spec&quot;: {&quot;controllers&quot;: {&quot;node&quot;: {&quot;hostEndpoint&quot;: {&quot;autoCreate&quot;: &quot;Enabled&quot;}}}}}'
</code></pre>
</li>
<li>
<p><strong>WireGuard Encryption</strong></p>
<pre><code class="language-yaml">apiVersion: projectcalico.org/v3
kind: FelixConfiguration
metadata:
  name: default
spec:
  wireguardEnabled: true
</code></pre>
</li>
<li>
<p><strong>Service Graph</strong></p>
<pre><code class="language-bash">calicoctl get serviceGraph -o wide
</code></pre>
</li>
</ol>
<hr>
<h2>Troubleshooting</h2>
<h3>Common Issues</h3>
<ol>
<li>
<p><strong>Pods can't communicate across nodes</strong></p>
<ul>
<li>Check BGP peer status</li>
<li>Verify IP pool CIDR matches cluster network</li>
<li>Ensure firewall allows Calico protocols</li>
</ul>
</li>
<li>
<p><strong>Network Policy not enforced</strong></p>
<ul>
<li>Check policy order (<code>calicoctl get policy -o wide</code>)</li>
<li>Verify selector matches pod labels</li>
</ul>
</li>
<li>
<p><strong>IPAM exhaustion</strong></p>
<pre><code>calicoctl ipam release --ip= --from=
</code></pre>
</li>
</ol>
<hr>
<h2>Configuration Discovery</h2>
<ol>
<li>
<p><strong>Cluster-wide Settings</strong></p>
<pre><code>calicoctl get clusterinformation -o yaml
</code></pre>
</li>
<li>
<p><strong>Node-specific Config</strong></p>
<pre><code>calicoctl get node  -o yaml
</code></pre>
</li>
<li>
<p><strong>Current State Analysis</strong></p>
<pre><code>calicoctl diags --include=all
</code></pre>
</li>
<li>
<p><strong>Policy Audit</strong></p>
<pre><code>calicoctl get networkpolicy -A -o yaml
</code></pre>
</li>
</ol>
<p>This comprehensive guide covers Calico's fundamentals through advanced features. For production deployments, always reference the <a href="https://docs.projectcalico.org/">official documentation</a> for version-specific details.</p>


    <nav class="post-navigation">
        
        <a href="/blogs/KnowledgeBase/kubertnetes/" class="parent-link">â Back to kubertnetes</a> | 
        
        <a href="/blogs/" class="home-link">Back to Home â</a>
    </nav>
</article>
        </main>
    </div>

    <footer class="container">
        <p>&copy; 2025 WISeAgent. Hosted with GitHub Pages.</p>
    </footer>
</body>
</html>